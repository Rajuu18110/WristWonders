<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WatchWonders</title>
    <link rel="stylesheet" href="./css/bootstrap.min.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        .star-rating i {
            color: #f39c12;
        }
    </style>
</head>

<body>
    <!-- Navbar will be loaded here -->
    <nav class="navbar navbar-expand-lg sticky-top bg-body-tertiary" id="navbar" style="background-color: #ffffff !important;">
    </nav>

    <!-- Responsive video section -->
    <div class="container-fluid p-0">
        <div class="ratio ratio-16x9">
            <video autoplay loop>
                <source src="./videos/firstRado.mp4" type="video/mp4">
                Your browser does not support the video tag.
            </video>
        </div>
    </div>

    <!-- Welcome message -->
    <div class="container-fluid p-0">
        <div class="row m-md-5 p-md-5">
            <div class="col-md-8 p-5 p-md-0">
                <h1>Welcome to WristWonders</h1>
                <p>Discover the ultimate destination for all your watch desires. At WatchWorld, we bring you an
                    extensive collection of timepieces from the world's most renowned brands, all in one place. Whether
                    you're seeking the elegance of luxury watches, the durability of sports models, or the timeless
                    charm of classic designs, our curated selection has something for everyone.</p>

                <p>Explore our diverse range, find the perfect watch to suit your style, and experience the
                    craftsmanship and innovation that define each piece. Enjoy a seamless shopping experience with our
                    user-friendly interface, detailed product information, and exceptional customer service.</p>
                <p>Thank you for choosing WatchWorld. We're excited to help you find your next favorite watch!</p>
            </div>
            <div class="col-md-4">
                <img src="./img/logo/black.png" class="img-fluid" alt="...">
            </div>
        </div>
    </div>

    <!-- Top sell bar -->
    <div class="container-fluid bg-black">
        <div class="row row-cols-1 row-cols-md-3 row-cols-lg-4 g-5 p-md-3 pb-md-5">
            <!-- Product cards will be dynamically injected here -->
        </div>
    </div>

    <!-- Video -->
    <div class="container-fluid">
        <div class="row align-items-center p-md-5">
            <div class="col-md-6 text-center text-md-left">
                <h1>True Square X Kunihiko Morinaga Special Edition</h1>
                <p>MAKING THE INVISIBLE VISIBLE</p>
                <hr class="my-4">
                <a href="#" class="btn btn-dark">Discover more</a>
            </div>
            <div class="col-md-6">
                <video autoplay loop class="img-fluid">
                    <source src="./videos/makeRado.mp4" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
            </div>
        </div>
    </div>

    <!-- Scripts at the end of body for better performance -->
    <script src="./js/bootstrap.bundle.min.js"></script>
    <script src="./js/components.js"></script>
    <script src="./js/main.js"></script>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const productList = document.querySelector('.container-fluid.bg-black .row');

        // Function to load products from JSON
        async function loadProducts() {
            try {
                const response = await fetch('./js/watches_catalog.json');
                const data = await response.json();
                return data.products.filter(product => product.topShow && product.gender === 'men');
            } catch (error) {
                console.error('Error loading products:', error);
                return [];
            }
        }

        // Function to create a product card
        function createProductCard(product) {
            const hasDiscount = product.discount > 0;
            const discountedPrice = product.price - (product.price * (product.discount / 100));
            return `
                <div class="col">
                    <div class="card h-100">
                        <img src="${product.image_url}" class="card-img-top img1 p-2" alt="Product image" style="display: block;">
                        <img src="${product.sideImg_url}" class="card-img-top img2 p-2" alt="Product side image" style="display: none;">
                        <div class="card-body">
                            <h5 class="card-title">${product.name}</h5>
                            ${hasDiscount ? `
                                    <h6>Price: <span class="text-muted"><s>$${product.price.toFixed(2)}</s></span></h6>
                                    <h6>Discounted Price: $${discountedPrice.toFixed(2)}</h6>
                                ` : `
                                    <h6>Price: $${product.price.toFixed(2)}</h6>
                                `}
                            <div class="star-rating mb-2">
                                ${Array.from({ length: 5 }, (_, index) => {
                                    const isFull = index < Math.floor(product.rating);
                                    const isHalf = index === Math.floor(product.rating) && (product.rating % 1) >= 0.5;
                                    return `<i class="bi bi-star${isFull ? '-fill' : ''}${isHalf ? '-half' : ''}"></i>`;
                                }).join('')}
                                <span class="ms-2">(${product.numRatings} ratings)</span>
                            </div>
                        </div>
                        <div class="card-footer">
                            <button class="btn btn-primary add-to-cart" data-name="${product.name}" data-price="${product.price}" data-disPrice="${discountedPrice.toFixed(2)}" data-image="${product.image_url}">Add to Cart</button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Function to add item to cart
        function addToCart(name, price, disPrice, image) {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const existingItem = cart.find(item => item.name === name);

            if (existingItem) {
                existingItem.quantity += 1; // Increment quantity if item already exists
            } else {
                cart.push({ name, price, disPrice, image, quantity: 1 });
            }

            localStorage.setItem('cart', JSON.stringify(cart));
            alert('Item added to cart!');
        }

        // Function to add event listeners to "Add to Cart" buttons
        function addCartEventListeners() {
            const addToCartButtons = document.querySelectorAll('.add-to-cart');
            addToCartButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const name = button.getAttribute('data-name');
                    const price = parseFloat(button.getAttribute('data-price'));
                    const disPrice = parseFloat(button.getAttribute('data-disPrice'));
                    const image = button.getAttribute('data-image');
                    addToCart(name, price, disPrice, image);
                });
            });
        }

        // Function to render products
        function renderProducts(products) {
            productList.innerHTML = products.map(createProductCard).join('');
            addCartEventListeners(); // Add event listeners to the new buttons
        }

        // Load and display products
        loadProducts().then(renderProducts);
    });
    </script>
</body>

</html>
